<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aura</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:system-ui,sans-serif; background:#fff7ed; height:100vh; overflow:hidden; display:grid; place-items:center; position:relative; }
    #welcome { text-align:center; }
    #welcome h1 { font-size:4rem; color:#ea580c; }
    #welcome button { padding:1.2rem 3rem; font-size:1.4rem; background:#ea580c; color:white; border:none; border-radius:999px; cursor:pointer; margin-top:1.5rem; }
    #editor-screen { display:none; width:100%; height:100%; position:absolute; top:0; left:0; background:white; }
    #editor { width:100%; height:calc(100% - 60px); padding:2rem; outline:none; }
    .topbar { height:60px; background:white; border-bottom:1px solid #eee; padding:0 1rem; display:flex; gap:10px; }
    .topbar button { padding:8px 14px; background:#fb923c; color:white; border:none; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>

<div id="welcome">
  <h1>Aura</h1>
  <p>Приватный редактор с end-to-end шифрованием</p>
  <button id="start">Создать документ →</button>
</div>

<div id="editor-screen">
  <div class="topbar">
    <button data-cmd="bold">Ж</button>
    <button data-cmd="italic">К</button>
    <button data-cmd="underline">П</button>
    <button data-cmd="strike">Зач</button>
    <button data-cmd="bulletList">•</button>
    <button data-cmd="orderedList">1.</button>
    <button data-cmd="insertTable">Таблица</button>
  </div>
  <div id="editor" contenteditable="true">Начните писать…</div>
</div>

<script>
let key;

async function getKey() {
  let h = location.hash.slice(1);
  if (!h) {
    key = await crypto.subtle.generateKey({name:"AES-GCM",length:256},true,["encrypt","decrypt"]);
    const raw = await crypto.subtle.exportKey("raw", key);
    location.hash = btoa(String.fromCharCode(...new Uint8Array(raw)));
  } else {
    const raw = Uint8Array.from(atob(h), c => c.charCodeAt(0));
    key = await crypto.subtle.importKey("raw", raw, "AES-GCM", false, ["encrypt","decrypt"]);
  }
}

async function startEditor() {
  await getKey();
  document.getElementById('welcome').style.display = 'none';
  document.getElementById('editor-screen').style.display = 'block';
}

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('start').onclick = startEditor;
  
  // Простые команды
  document.querySelectorAll('[data-cmd]').forEach(btn => {
    btn.onclick = () => {
      const cmd = btn.dataset.cmd;
      if (cmd === 'insertTable') {
        document.execCommand('insertHTML', false, '<table border="1" style="border-collapse:collapse;width:100%"><tr><td>1</td><td>2</td></tr><tr><td>3</td><td>4</td></tr></table>');
      } else {
        document.execCommand(cmd, false, null);
      }
    };
  });
});
</script>
</body>
</html>
